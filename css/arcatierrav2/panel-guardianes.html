<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vista de Empleados - Arca Tierra</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            /* Colores del manual de identidad */
            --terracota-principal: #B15543;
            --verde-principal: #33503E;
            --marron-oscuro: #562E26;
            --verde-secundario: #67795F;
            --verde-claro: #ABC59E;
            --beige: #EAD8B6;
            --crema: #F9F4E8;
            --blanco: #FFFFFF;
            --negro: #1A1A1A;
            --gris-oscuro: #4A4A4A;
            --gris-medio: #7A7A7A;
            --gris-claro: #CACACA;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--crema);
            color: var(--negro);
            overflow-x: hidden;
        }

        /* DASHBOARD DE EMPLEADOS */
        .employee-dashboard {
            width: 100%;
            min-height: 100vh;
            background: var(--crema);
        }

        .dashboard-header {
            background: linear-gradient(135deg, var(--verde-principal) 0%, var(--verde-secundario) 100%);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .dashboard-header h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .welcome-message {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .dashboard-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .dashboard-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .view-selector {
            display: flex;
            gap: 0.5rem;
        }

        .view-selector button {
            padding: 10px 20px;
            border: 2px solid var(--terracota-principal);
            background: white;
            color: var(--terracota-principal);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .view-selector button.active {
            background: var(--terracota-principal);
            color: white;
        }

        .employee-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .employee-selector select {
            padding: 10px 15px;
            border: 2px solid var(--terracota-principal);
            border-radius: 10px;
            background: white;
            color: var(--terracota-principal);
            font-weight: 600;
        }

        .export-controls {
            display: flex;
            gap: 0.5rem;
        }

        .export-btn {
            padding: 10px 15px;
            background: var(--terracota-principal);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: var(--marron-oscuro);
            transform: translateY(-2px);
        }

        /* CALENDARIO PRINCIPAL */
        .calendar-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .calendar-title {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: var(--verde-principal);
        }

        .calendar-navigation {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-btn {
            background: var(--terracota-principal);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: var(--marron-oscuro);
            transform: scale(1.1);
        }

        .current-date {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--verde-principal);
            min-width: 200px;
            text-align: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--gris-claro);
            border-radius: 10px;
            overflow: hidden;
        }

        .calendar-day-header {
            background: var(--verde-principal);
            color: white;
            padding: 1rem;
            text-align: center;
            font-weight: 600;
        }

        .calendar-day {
            background: white;
            padding: 1rem;
            min-height: 100px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-day:hover {
            background: var(--crema);
        }

        .calendar-day.today {
            background: var(--beige);
            border: 2px solid var(--terracota-principal);
        }

        .calendar-day.other-month {
            background: #f5f5f5;
            color: var(--gris-medio);
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .day-tasks {
            font-size: 0.8rem;
        }

        .task-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin: 1px;
        }

        .task-alta { background: #d32f2f; }
        .task-media { background: #f57c00; }
        .task-baja { background: #2e7d32; }

        /* M√âTRICAS PRINCIPALES */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .dashboard-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--verde-principal);
        }

        .card-icon {
            font-size: 1.5rem;
            color: var(--terracota-principal);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--terracota-principal);
            margin-bottom: 0.5rem;
        }

        .metric-label {
            color: var(--gris-medio);
            font-size: 0.9rem;
        }

        /* PROGRESO UNIFICADO */
        .progress-section {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .progress-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--verde-principal);
        }

        .team-percentage {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--terracota-principal);
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 1rem;
        }

        /* SISTEMA DE POST-ITS */
        .postits-section {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .postits-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .add-postit-btn {
            background: var(--terracota-principal);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .add-postit-btn:hover {
            background: var(--marron-oscuro);
            transform: translateY(-2px);
        }

        .postits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }

        .postit {
            background: #ffeb3b;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            transform: rotate(-1deg);
            transition: all 0.3s ease;
            position: relative;
        }

        .postit:nth-child(even) {
            transform: rotate(1deg);
        }

        .postit:hover {
            transform: rotate(0deg) scale(1.05);
            z-index: 10;
        }

        .postit.personal {
            background: #e1f5fe;
        }

        .postit.team {
            background: #f3e5f5;
        }

        .postit-header-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
            color: var(--gris-oscuro);
        }

        .postit-content {
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 0.5rem;
        }

        .postit-footer {
            font-size: 0.7rem;
            color: var(--gris-medio);
            text-align: right;
        }

        .delete-postit {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.7);
            color: white;
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: none;
        }

        .postit:hover .delete-postit {
            display: block;
        }

        /* TASK LIST */
        .tasks-section {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            border-left: 4px solid var(--terracota-principal);
        }

        .task-item:hover {
            background: var(--crema);
        }

        .task-item.completed {
            opacity: 0.6;
            border-left-color: var(--verde-claro);
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-weight: 600;
            color: var(--verde-principal);
            margin-bottom: 0.25rem;
        }

        .task-time {
            font-size: 0.8rem;
            color: var(--gris-medio);
        }

        .task-priority {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .priority-alta {
            background: #ffebee;
            color: #d32f2f;
        }

        .priority-media {
            background: #fff3e0;
            color: #f57c00;
        }

        .priority-baja {
            background: #e8f5e8;
            color: #2e7d32;
        }

        /* TABLA DE EXPERIENCIAS */
        .experiences-table-container {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .search-filter {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .search-input {
            padding: 8px 12px;
            border: 2px solid var(--gris-claro);
            border-radius: 8px;
            width: 200px;
        }

        .filter-select {
            padding: 8px 12px;
            border: 2px solid var(--gris-claro);
            border-radius: 8px;
            background: white;
        }

        .experiences-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .experiences-table th,
        .experiences-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--gris-claro);
        }

        .experiences-table th {
            background: var(--crema);
            font-weight: 600;
            color: var(--verde-principal);
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-confirmado {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .status-pendiente {
            background: #fff3e0;
            color: #f57c00;
        }

        .status-cancelado {
            background: #ffebee;
            color: #d32f2f;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            margin: 0 2px;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: var(--verde-claro);
            color: var(--verde-principal);
        }

        .btn-delete {
            background: #ffcdd2;
            color: #d32f2f;
        }

        .action-btn:hover {
            transform: scale(1.05);
        }

        /* MODAL */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .modal-content h3 {
            color: var(--verde-principal);
            margin-bottom: 1rem;
            font-family: 'Playfair Display', serif;
        }

        .modal-content input,
        .modal-content textarea,
        .modal-content select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--gris-claro);
            border-radius: 10px;
            margin: 1rem 0;
            font-size: 16px;
        }

        .modal-content input:focus,
        .modal-content textarea:focus,
        .modal-content select:focus {
            outline: none;
            border-color: var(--terracota-principal);
        }

        .modal-btn {
            background: var(--terracota-principal);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .modal-btn:hover {
            background: var(--marron-oscuro);
            transform: translateY(-2px);
        }

        .modal-btn.secondary {
            background: var(--gris-medio);
        }

        .modal-btn.secondary:hover {
            background: var(--gris-oscuro);
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .dashboard-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .view-selector,
            .export-controls {
                justify-content: center;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .calendar-header {
                flex-direction: column;
                gap: 1rem;
            }

            .calendar-navigation {
                order: -1;
            }

            .dashboard-header h2 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- DASHBOARD DE EMPLEADOS -->
    <div class="employee-dashboard">
        <div class="dashboard-header">
            <h2><i class="fas fa-chart-line"></i> Panel de Empleados</h2>
            <div class="welcome-message" id="welcomeMessage"></div>
        </div>

        <div class="dashboard-content">
            <!-- CONTROLES DEL DASHBOARD -->
            <div class="dashboard-controls">
                <div class="view-selector">
                    <button class="active" onclick="changeEmployeeView('month')">Mes</button>
                    <button onclick="changeEmployeeView('week')">Semana</button>
                    <button onclick="changeEmployeeView('day')">D√≠a</button>
                    <button onclick="changeEmployeeView('today')">Hoy</button>
                </div>
                
                <div class="employee-selector">
                    <label for="employeeSelect">Empleado:</label>
                    <select id="employeeSelect" onchange="changeEmployee()">
                        <option value="melissa">Melissa (Coordinadora)</option>
                        <option value="sofia">Sof√≠a (Gu√≠a Senior)</option>
                        <option value="ortega">Ortega (Chef)</option>
                        <option value="carmen">Carmen (Log√≠stica)</option>
                        <option value="diego">Diego (Mantenimiento)</option>
                        <option value="ana">Ana (Atenci√≥n al Cliente)</option>
                    </select>
                </div>
                
                <div class="export-controls">
                    <button class="export-btn" onclick="exportEmployeeData('excel')">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                    <button class="export-btn" onclick="exportEmployeeData('pdf')">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="export-btn" onclick="exportEmployeeData('csv')">
                        <i class="fas fa-file-csv"></i> CSV
                    </button>
                    <button class="export-btn" onclick="exportEmployeeData('markdown')">
                        <i class="fas fa-file-alt"></i> MD
                    </button>
                </div>
            </div>

            <!-- CALENDARIO PRINCIPAL -->
            <section class="calendar-section">
                <div class="calendar-header">
                    <h2 class="calendar-title"><i class="fas fa-calendar-alt"></i> Calendario de Tareas</h2>
                    <div class="calendar-navigation">
                        <button class="nav-btn" onclick="navigateCalendar(-1)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div class="current-date" id="currentDate"></div>
                        <button class="nav-btn" onclick="navigateCalendar(1)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div id="calendarContainer"></div>
            </section>

            <!-- M√âTRICAS PRINCIPALES -->
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="card-header">
                        <span class="card-title">Total Experiencias</span>
                        <i class="fas fa-calendar-check card-icon"></i>
                    </div>
                    <div class="metric-value" id="totalExperiences">127</div>
                    <div class="metric-label">En vista actual</div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <span class="card-title">Ingresos Totales</span>
                        <i class="fas fa-dollar-sign card-icon"></i>
                    </div>
                    <div class="metric-value" id="totalRevenue">$2,847,500</div>
                    <div class="metric-label">MXN en vista actual</div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <span class="card-title">Ocupaci√≥n Promedio</span>
                        <i class="fas fa-users card-icon"></i>
                    </div>
                    <div class="metric-value" id="averageOccupancy">87%</div>
                    <div class="metric-label">De capacidad total</div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <span class="card-title" id="completedTasksTitle">2/5</span>
                        <i class="fas fa-check-circle card-icon"></i>
                    </div>
                    <div class="metric-value" id="completedTasksEmployee">Del empleado actual</div>
                    <div class="metric-label" id="completedTasksLabel">Tareas completadas</div>
                </div>
            </div>

            <!-- PROGRESO UNIFICADO -->
            <div class="progress-section">
                <div class="progress-header">
                    <div class="progress-title">Progreso del Equipo</div>
                    <div class="team-percentage" id="teamPercentage">75%</div>
                </div>
                <div class="chart-container">
                    <canvas id="teamChart"></canvas>
                </div>
            </div>

            <!-- SISTEMA DE POST-ITS -->
            <div class="postits-section">
                <div class="postits-header">
                    <h3><i class="fas fa-sticky-note"></i> Notas del Equipo</h3>
                    <button class="add-postit-btn" onclick="showAddPostit()">
                        <i class="fas fa-plus"></i> Nueva Nota
                    </button>
                </div>
                <div class="postits-grid" id="postitsGrid"></div>
            </div>

            <!-- LISTA DE TAREAS INTERACTIVA -->
            <div class="tasks-section">
                <div class="postits-header">
                    <h3><i class="fas fa-tasks"></i> Lista de Tareas</h3>
                    <span class="metric-label" id="taskProgress">2 de 5 completadas (40%)</span>
                </div>
                <div id="interactiveTasksList"></div>
            </div>

            <!-- TABLA DE EXPERIENCIAS -->
            <div class="experiences-table-container">
                <div class="table-header">
                    <h3><i class="fas fa-table"></i> Experiencias Detalladas</h3>
                    <div class="search-filter">
                        <input type="text" class="search-input" placeholder="Buscar..." id="searchInput" onkeyup="filterTable()">
                        <select class="filter-select" id="statusFilter" onchange="filterTable()">
                            <option value="">Todos los estatus</option>
                            <option value="confirmado">Confirmado</option>
                            <option value="pendiente">Pendiente</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                        <select class="filter-select" id="typeFilter" onchange="filterTable()">
                            <option value="">Todos los tipos</option>
                            <option value="publica">P√∫blica</option>
                            <option value="privada">Privada</option>
                        </select>
                    </div>
                </div>
                <div style="overflow-x: auto;">
                    <table class="experiences-table" id="experiencesTable">
                        <thead>
                            <tr>
                                <th>D√≠a</th>
                                <th>Fecha</th>
                                <th>Horario</th>
                                <th>Experiencia</th>
                                <th>Cliente/Aliado</th>
                                <th>Tipo</th>
                                <th>Estatus</th>
                                <th># Invitados</th>
                                <th>Chinampa</th>
                                <th>Vendedor</th>
                                <th>Gu√≠a</th>
                                <th>Chef</th>
                                <th>Status Pago</th>
                                <th>Contacto</th>
                                <th>Comentarios</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="experiencesTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL PARA AGREGAR POST-IT -->
    <div class="modal-overlay" id="postitModal">
        <div class="modal-content">
            <h3><i class="fas fa-sticky-note"></i> Nueva Nota</h3>
            <div style="margin: 1rem 0;">
                <label for="postitRecipient">Para:</label>
                <select id="postitRecipient">
                    <option value="todos">Todos (visible para todo el equipo)</option>
                    <option value="melissa">Melissa (Coordinadora)</option>
                    <option value="sofia">Sof√≠a (Gu√≠a Senior)</option>
                    <option value="ortega">Ortega (Chef)</option>
                    <option value="carmen">Carmen (Log√≠stica)</option>
                    <option value="diego">Diego (Mantenimiento)</option>
                    <option value="ana">Ana (Atenci√≥n al Cliente)</option>
                </select>
            </div>
            <textarea id="postitContent" placeholder="Escribe tu nota aqu√≠..." style="height: 100px; resize: vertical;"></textarea>
            <div style="margin-top: 1rem;">
                <button class="modal-btn" onclick="addPostit()">Crear Nota</button>
                <button class="modal-btn secondary" onclick="hideAddPostit()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // VARIABLES GLOBALES
        let currentEmployeeView = 'month';
        let currentEmployee = 'melissa';
        let currentDate = new Date();

        // DATOS DE EMPLEADOS
        const employees = {
            melissa: {
                name: 'Melissa',
                role: 'Coordinadora',
                avatar: 'üë©‚Äçüíº',
                color: '#e91e63',
                tasks: [
                    { id: 1, title: 'Revisar reservaciones del d√≠a', time: 'Hoy 8:00 AM', priority: 'alta', completed: true },
                    { id: 2, title: 'Coordinar con equipo de gu√≠as', time: 'Hoy 9:30 AM', priority: 'alta', completed: true },
                    { id: 3, title: 'Llamada con cliente corporativo', time: 'Hoy 11:00 AM', priority: 'media', completed: false },
                    { id: 4, title: 'Revisar inventario semanal', time: 'Hoy 2:00 PM', priority: 'media', completed: false },
                    { id: 5, title: 'Planificar actividades de ma√±ana', time: 'Hoy 4:00 PM', priority: 'baja', completed: false }
                ]
            },
            sofia: {
                name: 'Sof√≠a',
                role: 'Gu√≠a Senior',
                avatar: 'üë©‚Äçüè´',
                color: '#2196f3',
                tasks: [
                    { id: 6, title: 'Preparar material educativo', time: 'Hoy 7:00 AM', priority: 'alta', completed: true },
                    { id: 7, title: 'Guiar experiencia matutina', time: 'Hoy 9:00 AM', priority: 'alta', completed: true },
                    { id: 8, title: 'Capacitar nuevo gu√≠a', time: 'Hoy 1:00 PM', priority: 'media', completed: false },
                    { id: 9, title: 'Actualizar protocolo de seguridad', time: 'Hoy 3:00 PM', priority: 'media', completed: false }
                ]
            },
            ortega: {
                name: 'Ortega',
                role: 'Chef',
                avatar: 'üë®‚Äçüç≥',
                color: '#ff9800',
                tasks: [
                    { id: 10, title: 'Preparar ingredientes frescos', time: 'Hoy 6:00 AM', priority: 'alta', completed: true },
                    { id: 11, title: 'Cocinar para experiencia brunch', time: 'Hoy 10:30 AM', priority: 'alta', completed: true },
                    { id: 12, title: 'Planificar men√∫ de ma√±ana', time: 'Hoy 2:00 PM', priority: 'media', completed: false },
                    { id: 13, title: 'Inventario de cocina', time: 'Hoy 4:00 PM', priority: 'baja', completed: false }
                ]
            },
            carmen: {
                name: 'Carmen',
                role: 'Log√≠stica',
                avatar: 'üë©‚Äçüíª',
                color: '#4caf50',
                tasks: [
                    { id: 14, title: 'Coordinar transporte de clientes', time: 'Hoy 8:00 AM', priority: 'alta', completed: true },
                    { id: 15, title: 'Verificar equipos de seguridad', time: 'Hoy 9:00 AM', priority: 'alta', completed: false },
                    { id: 16, title: 'Actualizar base de datos', time: 'Hoy 11:00 AM', priority: 'media', completed: false },
                    { id: 17, title: 'Preparar reporte semanal', time: 'Hoy 3:00 PM', priority: 'baja', completed: false }
                ]
            },
            diego: {
                name: 'Diego',
                role: 'Mantenimiento',
                avatar: 'üë®‚Äçüîß',
                color: '#795548',
                tasks: [
                    { id: 18, title: 'Revisar trajineras', time: 'Hoy 7:00 AM', priority: 'alta', completed: true },
                    { id: 19, title: 'Mantenimiento de senderos', time: 'Hoy 10:00 AM', priority: 'media', completed: true },
                    { id: 20, title: 'Reparar sistema de riego', time: 'Hoy 1:00 PM', priority: 'alta', completed: false },
                    { id: 21, title: 'Limpieza general de instalaciones', time: 'Hoy 3:00 PM', priority: 'baja', completed: false }
                ]
            },
            ana: {
                name: 'Ana',
                role: 'Atenci√≥n al Cliente',
                avatar: 'üë©‚Äçüíº',
                color: '#9c27b0',
                tasks: [
                    { id: 22, title: 'Responder consultas por email', time: 'Hoy 8:30 AM', priority: 'media', completed: true },
                    { id: 23, title: 'Llamadas de seguimiento', time: 'Hoy 10:00 AM', priority: 'alta', completed: true },
                    { id: 24, title: 'Actualizar redes sociales', time: 'Hoy 12:00 PM', priority: 'media', completed: false },
                    { id: 25, title: 'Procesar nuevas reservaciones', time: 'Hoy 2:00 PM', priority: 'alta', completed: false }
                ]
            }
        };

        // DATOS SIMULADOS DE EXPERIENCIAS DETALLADAS
        const detailedExperiences = [
            {
                dia: 'Lunes', fecha: '15/01/2025', horario: '5:30 AM', experiencia: 'Amanecer Chinampero',
                cliente: 'Hotel Boutique CDMX', tipo: 'publica', estatus: 'confirmado', invitados: 12,
                chinampa: 'Chinampa del Sol', vendedor: 'Ana Garc√≠a', guia: 'Sof√≠a Mart√≠nez',
                chef: 'Ortega L√≥pez', statusPago: 'Pagado', contacto: 'reservas@hotelboutique.com',
                comentarios: 'Grupo corporativo, solicitan factura'
            },
            {
                dia: 'Lunes', fecha: '15/01/2025', horario: '11:00 AM', experiencia: 'Brunch Chinampero',
                cliente: 'Familia Rodr√≠guez', tipo: 'publica', estatus: 'confirmado', invitados: 6,
                chinampa: 'Chinampa Verde', vendedor: 'Carmen Silva', guia: 'Diego Hern√°ndez',
                chef: 'Ortega L√≥pez', statusPago: 'Pagado', contacto: 'maria.rodriguez@email.com',
                comentarios: 'Celebraci√≥n de aniversario'
            },
            {
                dia: 'Martes', fecha: '16/01/2025', horario: '10:00 AM', experiencia: 'Chinampa en Familia',
                cliente: 'Escuela Primaria Benito Ju√°rez', tipo: 'publica', estatus: 'pendiente', invitados: 25,
                chinampa: 'Chinampa Educativa', vendedor: 'Ana Garc√≠a', guia: 'Sof√≠a Mart√≠nez',
                chef: 'Ortega L√≥pez', statusPago: 'Pendiente', contacto: 'direccion@escuelabjuarez.edu.mx',
                comentarios: 'Excursi√≥n escolar, requieren actividades educativas'
            },
            {
                dia: 'Jueves', fecha: '18/01/2025', horario: '9:00 AM', experiencia: 'D√≠a de Campo y Siembra',
                cliente: 'Grupo de Yoga Namaste', tipo: 'publica', estatus: 'confirmado', invitados: 15,
                chinampa: 'Chinampa del Sol', vendedor: 'Carmen Silva', guia: 'Sof√≠a Mart√≠nez',
                chef: 'Ortega L√≥pez', statusPago: 'Pagado', contacto: 'info@yoganamaste.com',
                comentarios: 'Retiro de bienestar, dieta vegetariana'
            },
            {
                dia: 'Jueves', fecha: '18/01/2025', horario: '2:00 PM', experiencia: 'Arcano por un D√≠a',
                cliente: 'Empresa Tech Solutions', tipo: 'privada', estatus: 'confirmado', invitados: 20,
                chinampa: 'Chinampa Corporativa', vendedor: 'Ana Garc√≠a', guia: 'Diego Hern√°ndez',
                chef: 'Ortega L√≥pez', statusPago: 'Pagado', contacto: 'eventos@techsolutions.com',
                comentarios: 'Team building corporativo'
            },
            {
                dia: 'S√°bado', fecha: '20/01/2025', horario: '10:00 AM', experiencia: 'Cocina de Temporada',
                cliente: 'Chef Internacional Marco', tipo: 'privada', estatus: 'confirmado', invitados: 8,
                chinampa: 'Chinampa Gourmet', vendedor: 'Carmen Silva', guia: 'Sof√≠a Mart√≠nez',
                chef: 'Ortega L√≥pez', statusPago: 'Pagado', contacto: 'marco.chef@international.com',
                comentarios: 'Intercambio culinario, grabaci√≥n para documental'
            }
        ];

        // MENSAJES DE BIENVENIDA MOTIVADORES
        const welcomeMessages = [
            "¬°Hola campe√≥n! üå± ¬°Listo para hacer magia en las chinampas hoy!",
            "¬°Buenos d√≠as, guardi√°n de las chinampas! üöÄ ¬°Tu energ√≠a ilumina Xochimilco!",
            "¬°Saludos, maestro de la naturaleza! ‚ú® ¬°Hoy ser√° un d√≠a incre√≠ble!",
            "¬°Hola, embajador de la sustentabilidad! üåø ¬°Tu trabajo transforma vidas!",
            "¬°Buenos d√≠as, h√©roe verde! üíö ¬°Las chinampas te esperan con alegr√≠a!",
            "¬°Hola, artista de las experiencias! üé® ¬°Hoy crearemos momentos √∫nicos!",
            "¬°Saludos, protector de tradiciones! üè∫ ¬°Tu pasi√≥n inspira a todos!",
            "¬°Buenos d√≠as, constructor de sue√±os! üåü ¬°Cada d√≠a es una nueva aventura!",
            "¬°Hola, sembrador de sonrisas! üòä ¬°Tu trabajo florece en cada coraz√≥n!",
            "¬°Saludos, guardi√°n de la biodiversidad! ü¶ã ¬°Eres parte de algo extraordinario!"
        ];

        // SISTEMA DE POST-ITS
        let postits = JSON.parse(localStorage.getItem('arcaTierraPostits') || '[]');

        // INICIALIZACI√ìN
        document.addEventListener('DOMContentLoaded', function() {
            // Mostrar mensaje de bienvenida aleatorio
            const randomMessage = welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];
            document.getElementById('welcomeMessage').textContent = randomMessage;
            
            // Inicializar dashboard
            updateEmployeeMetrics();
            loadPostits();
            loadInteractiveTasks();
            loadExperiencesTable();
            initializeCharts();
            renderCalendar();
        });

        // FUNCIONES PRINCIPALES
        function changeEmployeeView(view) {
            currentEmployeeView = view;
            
            // Actualizar botones activos
            document.querySelectorAll('.view-selector button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Actualizar m√©tricas seg√∫n la vista
            updateEmployeeMetrics();
            renderCalendar();
        }

        function changeEmployee() {
            currentEmployee = document.getElementById('employeeSelect').value;
            updateEmployeeMetrics();
            loadInteractiveTasks();
            updateTeamChart();
        }

        function updateEmployeeMetrics() {
            const metrics = getMetricsForView(currentEmployeeView);
            
            document.getElementById('totalExperiences').textContent = metrics.experiences;
            document.getElementById('totalRevenue').textContent = `$${metrics.revenue.toLocaleString()}`;
            document.getElementById('averageOccupancy').textContent = `${metrics.occupancy}%`;
            
            // Actualizar tareas completadas para el empleado actual
            const employee = employees[currentEmployee];
            const completedTasks = employee.tasks.filter(task => task.completed).length;
            const totalTasks = employee.tasks.length;
            const percentage = Math.round((completedTasks / totalTasks) * 100);
            
            document.getElementById('completedTasksTitle').textContent = `${completedTasks}/${totalTasks}`;
            document.getElementById('completedTasksEmployee').textContent = `${employee.name} (${percentage}%)`;
        }

        function getMetricsForView(view) {
            const metrics = {
                month: { experiences: 127, revenue: 2847500, occupancy: 87 },
                week: { experiences: 32, revenue: 687200, occupancy: 92 },
                day: { experiences: 5, revenue: 98500, occupancy: 78 },
                today: { experiences: 3, revenue: 45200, occupancy: 85 }
            };
            
            return metrics[view] || metrics.month;
        }

        // FUNCIONES DEL CALENDARIO
        function renderCalendar() {
            const container = document.getElementById('calendarContainer');
            const currentDateElement = document.getElementById('currentDate');
            
            if (currentEmployeeView === 'month') {
                renderMonthView(container);
                currentDateElement.textContent = currentDate.toLocaleDateString('es-MX', { 
                    month: 'long', 
                    year: 'numeric' 
                }).toUpperCase();
            } else if (currentEmployeeView === 'week') {
                renderWeekView(container);
                const weekStart = getWeekStart(currentDate);
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekEnd.getDate() + 6);
                currentDateElement.textContent = `${weekStart.getDate()} - ${weekEnd.getDate()} ${weekStart.toLocaleDateString('es-MX', { month: 'long', year: 'numeric' })}`.toUpperCase();
            } else if (currentEmployeeView === 'day' || currentEmployeeView === 'today') {
                renderDayView(container);
                currentDateElement.textContent = currentDate.toLocaleDateString('es-MX', { 
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long', 
                    year: 'numeric' 
                }).toUpperCase();
            }
        }

        function renderMonthView(container) {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            let html = '<div class="calendar-grid">';
            
            // Headers de d√≠as
            const dayHeaders = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
            dayHeaders.forEach(day => {
                html += `<div class="calendar-day-header">${day}</div>`;
            });
            
            // D√≠as del calendario
            const currentDateObj = new Date();
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const isCurrentMonth = date.getMonth() === month;
                const isToday = date.toDateString() === currentDateObj.toDateString();
                const dayTasks = getTasksForDate(date);
                
                let dayClass = 'calendar-day';
                if (!isCurrentMonth) dayClass += ' other-month';
                if (isToday) dayClass += ' today';
                
                html += `<div class="${dayClass}">
                    <div class="day-number">${date.getDate()}</div>
                    <div class="day-tasks">
                        ${dayTasks.map(task => `<span class="task-dot task-${task.priority}"></span>`).join('')}
                    </div>
                </div>`;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function renderWeekView(container) {
            const weekStart = getWeekStart(currentDate);
            let html = '<div class="calendar-grid">';
            
            // Headers de d√≠as
            const dayHeaders = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
            dayHeaders.forEach(day => {
                html += `<div class="calendar-day-header">${day}</div>`;
            });
            
            // D√≠as de la semana
            const currentDateObj = new Date();
            for (let i = 0; i < 7; i++) {
                const date = new Date(weekStart);
                date.setDate(weekStart.getDate() + i);
                
                const isToday = date.toDateString() === currentDateObj.toDateString();
                const dayTasks = getTasksForDate(date);
                
                let dayClass = 'calendar-day';
                if (isToday) dayClass += ' today';
                
                html += `<div class="${dayClass}">
                    <div class="day-number">${date.getDate()}</div>
                    <div class="day-tasks">
                        ${dayTasks.map(task => `
                            <div style="font-size: 0.7rem; margin: 2px 0; padding: 2px; background: rgba(177, 85, 67, 0.1); border-radius: 3px;">
                                ${task.title.substring(0, 20)}...
                            </div>
                        `).join('')}
                    </div>
                </div>`;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function renderDayView(container) {
            const employee = employees[currentEmployee];
            const dayTasks = employee.tasks;
            
            let html = `<div style="background: white; border-radius: 10px; padding: 2rem;">
                <h3 style="color: var(--verde-principal); margin-bottom: 1rem;">
                    Tareas de ${employee.name} - ${currentDate.toLocaleDateString('es-MX')}
                </h3>
                <div style="display: grid; gap: 1rem;">`;
            
            dayTasks.forEach(task => {
                html += `
                    <div class="task-item ${task.completed ? 'completed' : ''}">
                        <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} 
                               onchange="toggleTask(${task.id})">
                        <div class="task-content">
                            <div class="task-title">${task.title}</div>
                            <div class="task-time">${task.time}</div>
                        </div>
                        <div class="task-priority priority-${task.priority}">${task.priority.toUpperCase()}</div>
                    </div>
                `;
            });
            
            html += '</div></div>';
            container.innerHTML = html;
        }

        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day;
            return new Date(d.setDate(diff));
        }

        function getTasksForDate(date) {
            const employee = employees[currentEmployee];
            // Simulamos tareas para diferentes d√≠as
            if (date.getDay() === 1) { // Lunes
                return employee.tasks.slice(0, 2);
            } else if (date.getDay() === 3) { // Mi√©rcoles
                return employee.tasks.slice(2, 4);
            } else if (date.getDay() === 5) { // Viernes
                return employee.tasks.slice(4);
            }
            return [];
        }

        function navigateCalendar(direction) {
            if (currentEmployeeView === 'month') {
                currentDate.setMonth(currentDate.getMonth() + direction);
            } else if (currentEmployeeView === 'week') {
                currentDate.setDate(currentDate.getDate() + (direction * 7));
            } else if (currentEmployeeView === 'day' || currentEmployeeView === 'today') {
                currentDate.setDate(currentDate.getDate() + direction);
            }
            renderCalendar();
        }

        // SISTEMA DE POST-ITS
        function showAddPostit() {
            document.getElementById('postitModal').style.display = 'flex';
        }

        function hideAddPostit() {
            document.getElementById('postitModal').style.display = 'none';
            document.getElementById('postitContent').value = '';
            document.getElementById('postitRecipient').value = 'todos';
        }

        function addPostit() {
            const content = document.getElementById('postitContent').value.trim();
            const recipient = document.getElementById('postitRecipient').value;
            
            if (!content) {
                alert('Por favor escribe el contenido de la nota');
                return;
            }
            
            const postit = {
                id: Date.now(),
                content: content,
                recipient: recipient,
                sender: currentEmployee,
                timestamp: new Date().toLocaleString('es-MX'),
                type: recipient === 'todos' ? 'team' : 'personal'
            };
            
            postits.push(postit);
            localStorage.setItem('arcaTierraPostits', JSON.stringify(postits));
            
            hideAddPostit();
            loadPostits();
        }

        function loadPostits() {
            const container = document.getElementById('postitsGrid');
            const visiblePostits = postits.filter(postit => 
                postit.type === 'team' || 
                postit.recipient === currentEmployee || 
                postit.sender === currentEmployee
            );
            
            container.innerHTML = visiblePostits.map(postit => `
                <div class="postit ${postit.type}">
                    <button class="delete-postit" onclick="deletePostit(${postit.id})">√ó</button>
                    <div class="postit-header-info">
                        <span><strong>De:</strong> ${employees[postit.sender]?.name || postit.sender}</span>
                        <span><strong>Para:</strong> ${postit.recipient === 'todos' ? 'Todos' : employees[postit.recipient]?.name || postit.recipient}</span>
                    </div>
                    <div class="postit-content">${postit.content}</div>
                    <div class="postit-footer">${postit.timestamp}</div>
                </div>
            `).join('');
        }

        function deletePostit(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta nota?')) {
                postits = postits.filter(postit => postit.id !== id);
                localStorage.setItem('arcaTierraPostits', JSON.stringify(postits));
                loadPostits();
            }
        }

        // SISTEMA DE TAREAS INTERACTIVAS
        function loadInteractiveTasks() {
            const container = document.getElementById('interactiveTasksList');
            const employee = employees[currentEmployee];
            
            container.innerHTML = employee.tasks.map(task => `
                <div class="task-item ${task.completed ? 'completed' : ''}">
                    <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} 
                           onchange="toggleTask(${task.id})">
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-time">${task.time}</div>
                    </div>
                    <div class="task-priority priority-${task.priority}">${task.priority.toUpperCase()}</div>
                </div>
            `).join('');
            
            updateTaskProgress();
        }

        function toggleTask(taskId) {
            const employee = employees[currentEmployee];
            const task = employee.tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                loadInteractiveTasks();
                updateEmployeeMetrics();
                updateTeamChart();
                renderCalendar();
            }
        }

        function updateTaskProgress() {
            const employee = employees[currentEmployee];
            const completedTasks = employee.tasks.filter(task => task.completed).length;
            const totalTasks = employee.tasks.length;
            const percentage = Math.round((completedTasks / totalTasks) * 100);
            
            document.getElementById('taskProgress').textContent = 
                `${completedTasks} de ${totalTasks} completadas (${percentage}%)`;
        }

        // TABLA DE EXPERIENCIAS
        function loadExperiencesTable() {
            const tbody = document.getElementById('experiencesTableBody');
            
            tbody.innerHTML = detailedExperiences.map(exp => `
                <tr>
                    <td>${exp.dia}</td>
                    <td>${exp.fecha}</td>
                    <td>${exp.horario}</td>
                    <td>${exp.experiencia}</td>
                    <td>${exp.cliente}</td>
                    <td>${exp.tipo}</td>
                    <td><span class="status-badge status-${exp.estatus}">${exp.estatus}</span></td>
                    <td>${exp.invitados}</td>
                    <td>${exp.chinampa}</td>
                    <td>${exp.vendedor}</td>
                    <td>${exp.guia}</td>
                    <td>${exp.chef}</td>
                    <td>${exp.statusPago}</td>
                    <td>${exp.contacto}</td>
                    <td>${exp.comentarios}</td>
                    <td>
                        <button class="action-btn btn-edit" onclick="editExperience('${exp.fecha}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn btn-delete" onclick="deleteExperience('${exp.fecha}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function filterTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const typeFilter = document.getElementById('typeFilter').value;
            
            const rows = document.querySelectorAll('#experiencesTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const status = row.querySelector('.status-badge').textContent;
                const type = row.cells[5].textContent;
                
                const matchesSearch = text.includes(searchTerm);
                const matchesStatus = !statusFilter || status === statusFilter;
                const matchesType = !typeFilter || type === typeFilter;
                
                row.style.display = matchesSearch && matchesStatus && matchesType ? '' : 'none';
            });
        }

        function editExperience(fecha) {
            alert(`Editando experiencia del ${fecha}`);
        }

        function deleteExperience(fecha) {
            if (confirm(`¬øEst√°s seguro de que quieres eliminar la experiencia del ${fecha}?`)) {
                alert(`Experiencia del ${fecha} eliminada`);
            }
        }

        // GR√ÅFICOS
        function initializeCharts() {
            initializeTeamChart();
        }

        function initializeTeamChart() {
            const ctx = document.getElementById('teamChart').getContext('2d');
            
            const teamData = Object.keys(employees).map(key => {
                const employee = employees[key];
                const completed = employee.tasks.filter(task => task.completed).length;
                const total = employee.tasks.length;
                return { 
                    name: employee.name,
                    completed: completed,
                    total: total,
                    percentage: Math.round((completed / total) * 100)
                };
            });
            
            // Calcular porcentaje total del equipo
            const totalCompleted = teamData.reduce((sum, emp) => sum + emp.completed, 0);
            const totalTasks = teamData.reduce((sum, emp) => sum + emp.total, 0);
            const teamPercentage = Math.round((totalCompleted / totalTasks) * 100);
            
            // Mostrar porcentaje total del equipo
            document.getElementById('teamPercentage').textContent = `${teamPercentage}%`;
            
            // Encontrar el m√°ximo de tareas para escalar la gr√°fica
            const maxTasks = Math.max(...teamData.map(emp => emp.total));
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: teamData.map(emp => `${emp.name} (${emp.percentage}%)`),
                    datasets: [{
                        label: 'Tareas Completadas',
                        data: teamData.map(emp => emp.completed),
                        backgroundColor: '#B15543',
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: maxTasks,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    return Math.floor(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const empData = teamData[context.dataIndex];
                                    return `${empData.completed}/${empData.total} tareas (${empData.percentage}%)`;
                                }
                            }
                        }
                    }
                },
                plugins: [{
                    afterDatasetsDraw: function(chart) {
                        const ctx = chart.ctx;
                        chart.data.datasets.forEach((dataset, i) => {
                            const meta = chart.getDatasetMeta(i);
                            meta.data.forEach((bar, index) => {
                                const empData = teamData[index];
                                ctx.fillStyle = '#1A1A1A';
                                ctx.font = 'bold 12px Arial';
                                ctx.textAlign = 'center';
                                ctx.textBaseline = 'bottom';
                                ctx.fillText(empData.completed, bar.x, bar.y - 5);
                            });
                        });
                    }
                }]
            });
        }

        function updateTeamChart() {
            // Actualizar gr√°fico del equipo cuando cambien las tareas
            const canvas = document.getElementById('teamChart');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            initializeTeamChart();
        }

        // EXPORTACI√ìN DE DATOS
        function exportEmployeeData(format) {
            const data = {
                view: currentEmployeeView,
                employee: employees[currentEmployee].name,
                metrics: getMetricsForView(currentEmployeeView),
                experiences: detailedExperiences,
                tasks: employees[currentEmployee].tasks,
                timestamp: new Date().toLocaleString('es-MX')
            };
            
            if (format === 'excel') {
                exportToCSV(data);
            } else if (format === 'pdf') {
                exportToPDF(data);
            } else if (format === 'csv') {
                exportToCSV(data);
            } else if (format === 'markdown') {
                exportToMarkdown(data);
            }
            
            alert(`Datos exportados en formato ${format.toUpperCase()}`);
        }

        function exportToCSV(data) {
            let csv = 'Vista,Empleado,Total Experiencias,Ingresos,Ocupaci√≥n\n';
            csv += `${data.view},${data.employee},${data.metrics.experiences},${data.metrics.revenue},${data.metrics.occupancy}%\n\n`;
            
            csv += 'EXPERIENCIAS DETALLADAS\n';
            csv += 'D√≠a,Fecha,Horario,Experiencia,Cliente,Tipo,Estatus,Invitados,Chinampa,Vendedor,Gu√≠a,Chef,Status Pago,Contacto,Comentarios\n';
            
            data.experiences.forEach(exp => {
                csv += `${exp.dia},${exp.fecha},${exp.horario},${exp.experiencia},${exp.cliente},${exp.tipo},${exp.estatus},${exp.invitados},${exp.chinampa},${exp.vendedor},${exp.guia},${exp.chef},${exp.statusPago},${exp.contacto},${exp.comentarios}\n`;
            });
            
            downloadFile(csv, `reporte_empleados_${data.view}_${Date.now()}.csv`, 'text/csv');
        }

        function exportToPDF(data) {
            let content = `REPORTE DE EMPLEADOS - ARCA TIERRA\n\n`;
            content += `Vista: ${data.view}\n`;
            content += `Empleado: ${data.employee}\n`;
            content += `Fecha: ${data.timestamp}\n\n`;
            content += `M√âTRICAS:\n`;
            content += `Total Experiencias: ${data.metrics.experiences}\n`;
            content += `Ingresos: $${data.metrics.revenue.toLocaleString()}\n`;
            content += `Ocupaci√≥n: ${data.metrics.occupancy}%\n\n`;
            
            downloadFile(content, `reporte_empleados_${data.view}_${Date.now()}.txt`, 'text/plain');
        }

        function exportToMarkdown(data) {
            let md = `# Reporte de Empleados - Arca Tierra\n\n`;
            md += `**Vista:** ${data.view}\n`;
            md += `**Empleado:** ${data.employee}\n`;
            md += `**Fecha:** ${data.timestamp}\n\n`;
            md += `## M√©tricas\n\n`;
            md += `- **Total Experiencias:** ${data.metrics.experiences}\n`;
            md += `- **Ingresos:** $${data.metrics.revenue.toLocaleString()}\n`;
            md += `- **Ocupaci√≥n:** ${data.metrics.occupancy}%\n\n`;
            
            downloadFile(md, `reporte_empleados_${data.view}_${Date.now()}.md`, 'text/markdown');
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // ATAJOS DE TECLADO
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                hideAddPostit();
            }
            
            if (e.key === 'Enter' && document.getElementById('postitModal').style.display === 'flex') {
                addPostit();
            }
        });

        console.log('üå± Arca Tierra - Vista de empleados con calendario principal cargada');
        console.log('üìÖ Calendario como elemento principal');
        console.log('üë• 6 empleados con tareas interactivas');
        console.log('üìä Gr√°ficas mejoradas con n√∫meros y porcentajes');
        console.log('üîÑ Vistas din√°micas que cambian el calendario');
    </script>
</body>
</html>

